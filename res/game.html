<html>
<head>
<script>
var size; // mark for pull, will run out of memory at some point
var name; // for web app it makes sense to get the name and pass
function pull(name) {
  send('pull', name, null);
}
function push(name, data) {
  send('push', name, data);
}
function send(path, name, data) {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', 'http://fuse.rupy.se/' + path + '?name=' + name + '&data=' + encodeURIComponent(data), true);
  xhr.setRequestHeader('Accept', 'text/event-stream');
  if(xhr) {
    xhr.onreadystatechange = function() {
      var state = (path == 'pull' ? 3 : 4);
      if(xhr.readyState == state) {
        if(state == 3) {
          event(path, xhr.responseText.substring(size, xhr.responseText.length));
          size = xhr.responseText.length;
        }
        else
          event(path, xhr.responseText);
      }
    };
    xhr.send();
  }
}
function event(path, data) {
  var body = data;
  
  if(path == 'pull')
    body = data.substring(5, data.length - 2);
  else
    body += '\n';
  
  document.getElementById(path).innerHTML += body;
}
</script>
</head>
<body>

<a href="javascript:pull('one');">pull</a>
<a href="javascript:push('one', 'list|room');">list</a>
<a href="javascript:push('one', 'room|two');">room</a>
<a href="javascript:push('one', 'exit');">exit</a>
<a href="javascript:push('one', 'chat|' + document.getElementById('chat').value);">chat</a>

<input id="chat">

<div id="pull">pull:</div>
<div id="push">push:</div>

</body>
</html>