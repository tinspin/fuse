<!DOCTYPE HTML>
<html>
<head>
<script>
  var x;
  var y;
  function touchStart(event) {
    event.preventDefault();
    x = event.touches[0].clientX;
    y = event.touches[0].clientY;
  }
  function touchMove(event) {
    if(!x || !y) {
      return;
    }
    event.preventDefault();
    var xUp = event.touches[0].clientX;
    var yUp = event.touches[0].clientY;
    var xDiff = x - xUp;
    var yDiff = y - yUp;
    if(Math.abs(xDiff) > Math.abs(yDiff)) {
      if(xDiff > 3) {
        action(37);
      } else if(xDiff < -3) {
        action(39);
      }
    } else {
      if(yDiff > 3) {
        action(38);
      } else if(yDiff < -3) {
        action(40);
      }
    }
    x = null;
    y = null;                                          
  };
  function keyDown(event) {
    action(event.keyCode)
  }
  function action(key) {
    if(key == 37)
      move(current, -50);
    if(key == 39)
      move(current, 50);
    if(key == 40)
      current.fuse.speed = 20;
    if(key == 38)
      current.fuse.speed = 4;
  }
</script>
<script>
  function element(name) {
    return document.getElementById(name);
  }
  var seed = 1;
  var speed = 3;
  var current;
  var height = [0, 0, 0, 0, 0];
  var cubes = [];
  var color = ['blue', 'green', 'orange', 'purple'];
  start(232423);
  function random() {
    var x = Math.sin(seed++) * 10000;
    return x - Math.floor(x);
  }
  function start(seed) {
    this.seed = seed;
    setInterval(tick, 33);
  }
  function tick() {
    for(var i = 0; i < cubes.length; i++) {
      var cube = cubes[i];
      if(cube.fuse.speed > 0) {
        var x = parseInt(cube.style.left, 10) / 50;
        var y = parseInt(cube.style.top, 10) + cube.fuse.speed;
        if(300 - y < height[x]) {
          y = 300 - height[x];
          if(x == 2 && y < 0) {
            element('play').innerHTML = '';
            height = [0, 0, 0, 0, 0];
            cubes = [];
          }
          else {
            height[x] += 50;
            cube.fuse.speed = 0;
          }
          spawn();
        }
        cube.style.top = y + 'px';
      }
    }
  }
  function move(cube, delta) {
    var col = parseInt(cube.style.left, 10) / 50
    var x = parseInt(cube.style.left, 10) + delta;
    var y = parseInt(cube.style.top, 10);
    if(x > 200) x = 200;
    if(x < 0) x = 0;
    if(height[col + delta / 50] < 300 - y)
      cube.style.left = x + 'px';
  }
  var max = 3;
  var min = 0;
  function spawn() {
    var r = Math.floor(random() * (max - min + 1)) + min;
    add(color[r], 100)
  }
  function add(color, x) {
    var img = document.createElement('img');
    img.src = 'svg/' + color + '.svg';
    img.style.position = 'absolute';
    img.style.left = x + 'px';
    img.style.top = '0px';
    img.fuse = {};
    img.fuse.speed = 4;
    element('play').appendChild(img);
    cubes.push(img);
    current = img;
  }
</script>
</head>
<body style="margin: 0px;">

<div id="play" style="width: 250px; height: 350px; background-color: black;">
<!--img id="blue" style="position: absolute; left: 0px;" src="svg/blue.svg">
<img id="green" style="position: absolute; left: 50px;" src="svg/green.svg">
<img id="orange" style="position: absolute; left: 100px;" src="svg/orange.svg">
<img id="purple" style="position: absolute; left: 150px;" src="svg/purple.svg">
<img id="red" style="position: absolute; left: 200px;" src="svg/red.svg"-->
</div>

<script>
  var div = element('play');
  document.addEventListener('keydown', keyDown);
  div.addEventListener('touchstart', touchStart, false);
  div.addEventListener('touchmove', touchMove, false);
  spawn();
</script>

</body>
</html>